<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Alexandria · New Looks</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              background: '#020617',
              foreground: '#f8fafc',
              muted: '#94a3b8',
              card: '#0f172a',
              border: 'rgba(255,255,255,0.08)',
              accent: '#38bdf8'
            },
            fontFamily: {
              display: ['Space Grotesk', 'Inter', 'ui-sans-serif', 'system-ui'],
              body: ['Inter', 'ui-sans-serif', 'system-ui']
            },
            boxShadow: {
              glow: '0 20px 45px rgba(15, 23, 42, 0.45)'
            }
          }
        }
      }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }
    </style>
  </head>
  <body class="bg-background text-foreground min-h-screen">
    <div class="relative min-h-screen overflow-hidden">
      <div class="pointer-events-none absolute inset-0">
        <div class="absolute -top-32 right-0 h-80 w-80 rounded-full bg-sky-500/30 blur-[120px]"></div>
        <div class="absolute bottom-0 left-0 h-96 w-96 rounded-full bg-indigo-500/20 blur-[140px]"></div>
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(56,189,248,0.06),_transparent_60%)]"></div>
      </div>

      <header class="relative z-10 max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pt-10 pb-8">
        <div class="flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between">
          <div class="space-y-4 max-w-3xl">
            <p class="text-xs uppercase tracking-[0.4em] text-sky-300/80">Experimental Surface</p>
            <h1 class="font-display text-4xl sm:text-5xl font-semibold text-white">
              The Alexandria Library — Future Facing Preview
            </h1>
            <p class="text-lg text-slate-300 max-w-2xl">
              Same trusted data, refreshed with a Tailwind + shadcn-inspired layer so you can stress-test
              new patterns without touching the core experience.
            </p>
          </div>
          <div class="flex flex-col gap-3 sm:flex-row lg:flex-col">
            <a
              href="{{ url_for('login') }}"
              class="inline-flex items-center justify-center rounded-2xl border border-white/20 bg-white/10 px-5 py-3 text-sm font-semibold text-white shadow-glow transition hover:bg-white/20"
              >Staff Login</a
            >
            <a
              href="{{ url_for('index') }}"
              class="inline-flex items-center justify-center rounded-2xl border border-white/10 px-5 py-3 text-sm font-medium text-slate-200/80 hover:text-white"
              >Back to Classic Library</a
            >
          </div>
        </div>

        <form method="get" class="mt-10 grid gap-4 lg:grid-cols-[2fr,1fr,auto]">
          <label class="flex flex-col gap-2">
            <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Search</span>
            <input
              type="search"
              name="q"
              value="{{ query }}"
              placeholder="Find an app by name"
              class="w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-base text-white placeholder:text-slate-500 focus:border-accent focus:ring-2 focus:ring-accent/50"
            />
          </label>
          <label class="flex flex-col gap-2">
            <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Tag filter</span>
            <select
              name="tag"
              class="w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-base text-white placeholder:text-slate-500 focus:border-accent focus:ring-2 focus:ring-accent/50"
            >
              <option value="" {% if not tag %}selected{% endif %}>All tags</option>
              {% for t in all_tags %}
              <option value="{{ t }}" {% if tag == t %}selected{% endif %}>{{ t }}</option>
              {% endfor %}
            </select>
          </label>
          <div class="flex items-end gap-2">
            <button
              type="submit"
              class="flex-1 rounded-2xl bg-white text-slate-900 px-6 py-3 text-sm font-semibold shadow-glow transition hover:bg-slate-100"
            >
              Apply
            </button>
            <a
              href="{{ url_for('new_looks') }}"
              class="rounded-2xl border border-white/15 px-4 py-3 text-sm font-medium text-slate-200 hover:text-white"
              >Reset</a
            >
          </div>
        </form>
      </header>

      <main class="relative z-10 max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
        <div class="flex flex-wrap items-center justify-between gap-4 border-t border-white/10 pt-6">
          <p class="text-sm text-slate-300">
            Showing <span class="font-semibold text-white">{{ apps|length }}</span> applications
            {% if query %}matching “{{ query }}”{% elif tag %}tagged “{{ tag }}”{% endif %}.
          </p>
          <div class="inline-flex items-center gap-2 rounded-full border border-white/10 px-4 py-2 text-xs uppercase tracking-wide text-slate-300">
            <span class="h-2 w-2 rounded-full bg-emerald-400"></span>
            Live data from Alexandria
          </div>
        </div>

        {% if not apps %}
        <div class="mt-12 rounded-3xl border border-white/10 bg-white/5 p-8 text-center text-slate-200">
          <p class="text-lg font-semibold">No apps match this filter yet.</p>
          <p class="mt-2 text-sm text-slate-400">Try clearing filters or searching for a different name.</p>
        </div>
        {% else %}
        <div class="mt-10 grid gap-6 sm:grid-cols-2 xl:grid-cols-3">
          {% for app in apps %}
          {% set status = app[8] or 'Uncategorized' %}
          {% set status_colors = {
            'Approved for Use': 'bg-emerald-500/15 text-emerald-200 border border-emerald-500/30',
            'Core Tool': 'bg-green-500/15 text-emerald-100 border border-green-400/30',
            'Supplemental Tool': 'bg-indigo-500/20 text-indigo-100 border border-indigo-400/30',
            'Use Alternate': 'bg-amber-500/15 text-amber-100 border border-amber-400/30',
            'Pending': 'bg-amber-500/10 text-amber-100 border border-amber-400/30',
            'Not Supported by District': 'bg-rose-500/15 text-rose-100 border border-rose-400/30',
            'Reviewed & Denied': 'bg-rose-500/20 text-rose-100 border border-rose-400/30'
          } %}
          {% set status_class = status_colors.get(status, 'bg-white/10 text-white/80 border border-white/15') %}
          {% set soppa = app[5] or 'Unknown' %}
          {% set soppa_colors = {
            'Compliant': 'bg-emerald-500/15 text-emerald-200 border border-emerald-400/30',
            'Policies are SOPPA compliant': 'bg-emerald-500/15 text-emerald-200 border border-emerald-400/30',
            'Staff use only': 'bg-blue-500/15 text-blue-100 border border-blue-400/30',
            'Not applicable': 'bg-slate-500/15 text-slate-100 border border-slate-400/30',
            'Unknown': 'bg-slate-500/15 text-slate-100 border border-slate-400/30',
            'Not fully SOPPA compliant': 'bg-amber-500/15 text-amber-100 border border-amber-400/30',
            'Noncompliant': 'bg-rose-600/20 text-rose-100 border border-rose-500/30',
            'Parent consent required': 'bg-purple-500/15 text-purple-100 border border-purple-400/30'
          } %}
          {% set soppa_class = soppa_colors.get(soppa, soppa_colors['Unknown']) %}
          {% set logo_src = None %}
          {% if app[11] %}
            {% if app[11].startswith('/static/') or app[11].startswith('http') %}
              {% set logo_src = app[11] %}
            {% else %}
              {% set logo_src = '/static/' + app[11] %}
            {% endif %}
          {% endif %}
          <article class="group rounded-3xl border border-white/10 bg-gradient-to-b from-white/10 to-white/5 p-6 shadow-glow transition hover:-translate-y-1 hover:border-white/20">
            <div class="flex items-start gap-4">
              <div class="h-16 w-16 flex items-center justify-center rounded-2xl bg-white/5 text-xl font-semibold">
                {% if logo_src %}
                <img src="{{ logo_src }}" alt="{{ app[1] }}" class="h-14 w-14 object-contain" />
                {% else %}
                <span>{{ app[1][:1] }}</span>
                {% endif %}
              </div>
              <div class="space-y-2 min-w-0">
                <div class="flex flex-wrap gap-2">
                  <span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold {{ status_class }}">{{ status }}</span>
                  <span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold {{ soppa_class }}">{{ soppa }}</span>
                </div>
                <h3 class="font-display text-xl text-white leading-tight break-words">{{ app[1] }}</h3>
                <p class="text-sm text-slate-300 truncate" title="{{ app[3] or 'Unknown Vendor' }}">{{ app[3] or 'Unknown Vendor' }}</p>
              </div>
            </div>
            {% if app[2] %}
            <p class="mt-4 text-sm text-slate-300" style="display:-webkit-box;line-clamp:3;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;">
              {{ app[2] }}
            </p>
            {% endif %}
            <div class="mt-5 grid gap-3 text-sm text-slate-200">
              <div class="flex flex-wrap gap-2">
                {% if app[4] %}
                <a
                  href="{{ app[4] }}"
                  target="_blank"
                  class="inline-flex items-center gap-1 rounded-xl border border-white/15 px-3 py-1 text-xs font-semibold text-white/90 hover:border-white/40"
                >
                  <span class="h-2 w-2 rounded-full bg-emerald-400"></span>
                  Privacy / NDPA
                </a>
                {% endif %}
                {% if app[6] %}
                <a
                  href="{{ app[6] }}"
                  target="_blank"
                  class="inline-flex items-center gap-1 rounded-xl border border-white/15 px-3 py-1 text-xs font-semibold text-white/90 hover:border-white/40"
                >
                  <span class="h-2 w-2 rounded-full bg-blue-400"></span>
                  Exhibit E / Docs
                </a>
                {% endif %}
                {% if app[7] %}
                  {% set invoice_paths = app[7].split(',') %}
                  {% for invoice in invoice_paths[:2] %}
                  {% set trimmed = invoice.strip() %}
                  {% if trimmed %}
                  <a
                    href="{{ trimmed }}"
                    target="_blank"
                    class="inline-flex items-center gap-1 rounded-xl border border-white/15 px-3 py-1 text-xs font-semibold text-white/90 hover:border-white/40"
                  >
                    <span class="h-2 w-2 rounded-full bg-amber-400"></span>
                    Invoice {{ loop.index }}
                  </a>
                  {% endif %}
                  {% endfor %}
                  {% if invoice_paths|length > 2 %}
                  <span class="inline-flex items-center rounded-xl border border-white/10 px-3 py-1 text-xs text-slate-200/80"
                    >+{{ invoice_paths|length - 2 }} more</span
                  >
                  {% endif %}
                {% endif %}
              </div>
              {% if app[9] %}
              <div class="flex flex-wrap gap-2">
                {% for t in app[9].split(',') if t.strip() %}
                <span class="rounded-full border border-white/10 bg-white/5 px-3 py-1 text-xs text-slate-200">{{ t.strip() }}</span>
                {% endfor %}
              </div>
              {% endif %}
            </div>
            <div class="mt-6 flex items-center justify-between text-xs text-slate-400">
              <div>App ID #{{ app[0] }}</div>
              <div class="flex items-center gap-2">
                <span class="h-2 w-2 rounded-full bg-accent animate-pulse"></span>
                Updated continuously
              </div>
            </div>
          </article>
          {% endfor %}
        </div>
        {% endif %}
      </main>

      <footer class="relative z-10 border-t border-white/10 bg-black/30">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6 text-sm text-slate-400 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
          <p>Previewing Alexandria with Tailwind/shadcn styling.</p>
          <p class="text-slate-500">Feedback? Send it to the library team.</p>
        </div>
      </footer>
    </div>
  </body>
</html>
